<!doctype html>
<html lang="en" class="h-full bg-black">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blindado â€” Org Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{brand:{500:'#00E0A4'}}}}};</script>
  <style>.glass{backdrop-filter:blur(10px);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)} .btn{padding:.55rem .9rem;border:1px solid rgba(255,255,255,.1);border-radius:.75rem}</style>
</head>
<body class="h-full text-white">
  <div class="max-w-5xl mx-auto p-6 space-y-8">
    <header class="flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
      <h1 class="text-2xl font-semibold">Org Admin</h1>
      <div class="flex flex-wrap gap-3 items-center">
        <input id="projectRef" class="glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="project ref" />
        <input id="orgId" class="glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="org_id (optional)" />
      </div>
    </header>

    <section class="grid md:grid-cols-2 gap-8">
      <div class="space-y-6">
        <div class="glass rounded-2xl p-5 space-y-4">
          <h2 class="font-medium text-lg">Invite Guard</h2>
          <div class="space-y-3">
            <input id="gEmail" class="w-full glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="email" />
            <div class="flex gap-3">
              <input id="gFirst" class="flex-1 glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="first name" />
              <input id="gLast" class="flex-1 glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="last name" />
            </div>
            <button id="btnInvite" class="btn">Invite</button>
          </div>
        </div>

        <div class="glass rounded-2xl p-5 space-y-4">
          <h2 class="font-medium text-lg">Upload Document</h2>
          <div class="space-y-3">
            <input id="profileId" class="w-full glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="profile_id" />
            <input id="docKind" class="w-full glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="kind (license, id_card, etc)" />
            <input id="docFile" class="w-full glass rounded-lg px-3 py-2 text-sm bg-black/30" placeholder="file path (after upload)" />
            <button id="btnDoc" class="btn">Insert Document</button>
          </div>
        </div>
      </div>

      <div class="space-y-4">
        <div class="glass rounded-2xl p-5">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-medium">Console</h2>
            <button class="text-xs opacity-70 hover:opacity-100" onclick="out('')">Clear</button>
          </div>
          <pre id="out" class="text-xs whitespace-pre-wrap"></pre>
        </div>
        <div class="text-xs opacity-70 leading-relaxed">
          <p>Flow:</p>
          <ol class="list-decimal ml-5 space-y-1">
            <li>Invite guard (creates auth user if absent).</li>
            <li>Upload file via uploads function (avatars or private buckets) to get URL.</li>
            <li>Insert document referencing uploaded file URL.</li>
          </ol>
        </div>
      </div>
    </section>
  </div>

<script>
  const projectRef = document.getElementById('projectRef');
  projectRef.value = new URLSearchParams(location.search).get('ref') || 'isnezquuwepqcjkaupjh';
  const orgId = document.getElementById('orgId');
  const out = (x)=> document.getElementById('out').textContent = typeof x==='string'? x : JSON.stringify(x,null,2);

  function fn(){ return `https://${projectRef.value}.supabase.co/functions/v1`; }

  async function call(path, body){
    const r = await fetch(fn()+path, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(body) });
    if(!r.ok) throw await r.text();
    return r.json();
  }

  document.getElementById('btnInvite').onclick = async ()=>{
    try{
      const res = await call('/admin_documents', { action:'invite_guard', payload:{ email: gEmail.value, first_name: gFirst.value, last_name: gLast.value } });
      out(res);
    }catch(e){ out(e); }
  };

  document.getElementById('btnDoc').onclick = async ()=>{
    try{
      const res = await call('/admin_documents', { action:'insert_document', payload:{ profile_id: profileId.value, org_id: orgId.value || null, kind: docKind.value, file_url: docFile.value } });
      out(res);
    }catch(e){ out(e); }
  };
</script>
</body>
</html>
