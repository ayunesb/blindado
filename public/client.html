<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Escolta — Book Armed Protectors</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg: #000;
      --card: rgba(255,255,255,.04);
      --border: rgba(255,255,255,.10);
      --text: #fff;
      --muted: rgba(255,255,255,.62);
      --accent: #ef4444; /* subtle red accent (swap to brand hex if needed) */
      --radius: 22px;
    }
    * { -webkit-tap-highlight-color: transparent; }
    html,body{ background:var(--bg); color:var(--text); }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); }
    .glass{ backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    .button-primary{
      border-radius: 9999px; background:#fff; color:#000;
      padding:.95rem 1.25rem; font-weight:600;
      transition: .2s ease;
    }
    .button-primary:hover{ filter: brightness(1.02); }
    .pill{ border:1px solid var(--border); border-radius:9999px; padding:.4rem .8rem; color:var(--muted); }
    /* Hide any dev panels/logs someone left around */
    #logs,#log,.logs,.debug,.debug-panel,pre:has(#logs){ display:none !important; }
    /* Safe-area for iOS */
    .safe-bottom{ padding-bottom: max(16px, env(safe-area-inset-bottom)); }
    /* Dialog polish */
    dialog{ border:none; padding:0; background:transparent; }
    dialog::backdrop{ background:rgba(0,0,0,.6); }
  </style>
</head>
<body class="min-h-screen antialiased">

  <!-- Top bar with brand -->
  <header class="max-w-screen-md mx-auto px-5 py-4 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <!-- Inline brand mark (replace with your SVG if you want) -->
      <svg width="28" height="28" viewBox="0 0 48 48" class="shrink-0">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#fff" stop-opacity=".95"/>
            <stop offset="1" stop-color="#d4d4d4" stop-opacity=".95"/>
          </linearGradient>
        </defs>
        <path d="M24 4l16 6v12c0 11-7 20-16 22C15 42 8 33 8 22V10l16-6z" fill="url(#g)" opacity=".12"/>
        <path d="M24 8l12 4v10c0 9-6 16-12 18-6-2-12-9-12-18V12l12-4z" fill="none" stroke="#fff" stroke-opacity=".6" stroke-width="1.2"/>
        <!-- chevron motif -->
        <path d="M16 19h16M18 23h12M20 27h8" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="tracking-wide font-semibold">ESCOLTA</span>
      <span class="pill ml-2 hidden sm:inline">New York City</span>
    </div>
    <a href="#" class="pill">Account</a>
  </header>

  <!-- Hero -->
  <section class="relative">
    <img
      src="https://images.unsplash.com/photo-1512511708750-2078b3a8a38a?q=80&w=2000&auto=format&fit=crop"
      class="absolute inset-0 w-full h-[46vh] object-cover opacity-70 pointer-events-none"
      alt="">
    <div class="relative z-10 max-w-screen-md mx-auto px-5 pt-8 pb-6">
      <h1 class="text-4xl leading-tight font-semibold">
        Book Armed Protectors in<br/>New York City
      </h1>
      <button id="ctaBook" class="button-primary w-full mt-5">Book a Protector</button>
    </div>
  </section>

  <!-- Value props -->
  <section class="max-w-screen-md mx-auto px-5 -mt-4 space-y-4">
    <div class="card glass p-5 flex gap-4">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-white/5 border border-white/10">
        <!-- badge -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4z"/><circle cx="12" cy="10" r="3"/></svg>
      </div>
      <p class="text-lg leading-snug">Armed Protectors will be right by your side, ensuring your safety.</p>
    </div>
    <div class="card glass p-5 flex gap-4">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-white/5 border border-white/10">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 4h18v6l-9 5-9-5V4z"/><path d="M3 10v10l9 5 9-5V10"/></svg>
      </div>
      <p class="text-lg leading-snug">Our Protectors are only Active Duty or Retired Law Enforcement and Military.</p>
    </div>
    <div class="card glass p-5 flex gap-4">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-white/5 border border-white/10">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 16l1-4h16l1 4"/><path d="M5 12l1-4h12l1 4"/><circle cx="7.5" cy="18.5" r="1.5"/><circle cx="16.5" cy="18.5" r="1.5"/></svg>
      </div>
      <p class="text-lg leading-snug">Black car transportation is included for safe and effortless city travel.</p>
    </div>
  </section>

  <!-- Meet the Protectors -->
  <section class="max-w-screen-md mx-auto px-5 mt-10">
    <h2 class="text-2xl font-semibold mb-4">Meet the Protectors</h2>
    <div class="grid grid-cols-1 gap-5">
      <article class="card overflow-hidden">
        <img src="https://images.unsplash.com/photo-1565374371357-7f27b30f2e1c?q=80&w=1600&auto=format&fit=crop"
             alt="Protector" class="w-full aspect-[16/11] object-cover" />
        <div class="p-5">
          <h3 class="text-xl font-semibold">Chris</h3>
          <p class="text-white/60 mt-1">Former New York Police and Former United States Military</p>
        </div>
      </article>
    </div>
  </section>

  <!-- Sticky bottom nav (mobile look) -->
  <nav class="fixed inset-x-0 bottom-2 px-4 safe-bottom">
    <div class="mx-auto max-w-screen-md card glass px-6 py-3 flex items-center justify-between">
      <button class="text-sm opacity-90">Protector</button>
      <button class="text-sm opacity-60">Bookings</button>
      <button class="text-sm opacity-60">Account</button>
    </div>
  </nav>

  <!-- Booking bottom sheet -->
  <dialog id="sheet" class="w-full max-w-screen-md mx-auto">
    <form method="dialog" class="card glass rounded-t-3xl bg-[#0b0b0b] px-5 pt-4 pb-6">
      <div class="flex items-center gap-2 mb-4">
  <button id="closeSheet" class="rounded-lg px-2 py-1 hover:bg-white/5" value="close" aria-label="Close">←</button>
        <h3 class="text-2xl font-semibold">Where should we have your motorcade meet you?</h3>
      </div>

      <div class="space-y-4">
        <label class="block card glass p-4">
          <div class="text-white/60 text-sm mb-1">Pickup Location</div>
          <input id="loc" type="text" placeholder="Street, hotel, or venue"
                 class="w-full bg-transparent outline-none placeholder-white/30">
        </label>

        <label class="block card glass p-4">
          <div class="text-white/60 text-sm mb-1">Pickup Date</div>
          <input id="date" type="date" class="w-full bg-transparent outline-none">
        </label>

        <label class="block card glass p-4">
          <div class="text-white/60 text-sm mb-1">Pickup Time</div>
          <input id="time" type="time" class="w-full bg-transparent outline-none">
        </label>

        <label class="block card glass p-4">
          <div class="text-white/60 text-sm mb-1">Duration of Protection (hours)</div>
          <input id="hours" type="number" min="1" step="1" value="4"
                 class="w-full bg-transparent outline-none">
        </label>
      </div>

      <button id="nextBtn" type="button" class="button-primary w-full mt-6">Next</button>
    </form>
  </dialog>

  <!-- Quote modal -->
  <dialog id="quoteModal" class="w-full max-w-md mx-auto">
    <form method="dialog" class="rounded-3xl overflow-hidden bg-zinc-100 text-zinc-900">
      <div class="p-6">
        <div class="flex items-center gap-2">
          <!-- tiny brand -->
          <svg width="20" height="20" viewBox="0 0 48 48">
            <path d="M24 8l12 4v10c0 9-6 16-12 18-6-2-12-9-12-18V12l12-4z" fill="#111" opacity=".08"/>
            <path d="M16 19h16M18 23h12M20 27h8" stroke="#111" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3 class="text-xl font-semibold">Instant Quote</h3>
        </div>
        <p class="text-zinc-600 mt-1">Based on your pickup and duration.</p>

        <dl class="mt-6 space-y-2 text-sm">
          <div class="flex justify-between"><dt>Base (per hour)</dt><dd id="qBase"></dd></div>
          <div class="flex justify-between"><dt>Hours</dt><dd id="qHours"></dd></div>
          <div class="flex justify-between"><dt>Black Car</dt><dd id="qCar"></dd></div>
          <div class="flex justify-between"><dt>Taxes & Fees</dt><dd id="qFees"></dd></div>
          <div class="border-t border-zinc-300 my-3"></div>
          <div class="flex justify-between font-semibold text-lg"><dt>Total</dt><dd id="qTotal"></dd></div>
        </dl>
      </div>
      <div class="p-6 pt-0 flex gap-3 bg-zinc-100">
        <button class="flex-1 rounded-xl py-3 bg-zinc-200 hover:bg-zinc-300" value="cancel">Back</button>
        <button id="confirmBtn" class="flex-1 rounded-xl py-3 bg-black text-white hover:opacity-90">Confirm</button>
      </div>
    </form>
  </dialog>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 hidden">
    <div class="bg-white/95 text-black px-5 py-3 rounded-xl shadow-lg">Request submitted. We’ll be in touch.</div>
  </div>

  <script>
    // Helpers
    const $ = (s)=>document.querySelector(s);
    const params = new URLSearchParams(location.search);
    const sbUrl  = params.get('sb');
    const sbAnon = params.get('anon');
    const debug  = params.get('debug') === '1';

    const money = (n)=>new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(n);

    // Supabase (optional)
    let supabase = null;
    if (sbUrl && sbAnon) {
      try { supabase = window.supabase.createClient(decodeURIComponent(sbUrl), sbAnon); }
      catch(e){ console.warn('Supabase error', e); }
    }

    // UI wiring
    const sheet = $('#sheet'), quoteModal = $('#quoteModal');
    $('#ctaBook').addEventListener('click', ()=>sheet.showModal());
    $('#closeSheet').addEventListener('click', ()=>sheet.close());
    $('#nextBtn').addEventListener('click', handleQuote);
    $('#confirmBtn').addEventListener('click', handleConfirm);

    async function handleQuote(){
      const loc = $('#loc').value.trim();
      const date = $('#date').value;
      const time = $('#time').value;
      const hours = Math.max(1, parseInt($('#hours').value||'0',10));

      if(!loc || !date || !time || !hours){ alert('Please complete all fields.'); return; }

      // Pricing (swap to RPC if you have one)
      const RATE=149, CAR=99, FEES=0.08875;
      const base = RATE*hours;
      const fees = (base+CAR)*FEES;
      const total = base+CAR+fees;

      $('#qBase').textContent  = money(RATE);
      $('#qHours').textContent = hours+'h';
      $('#qCar').textContent   = money(CAR);
      $('#qFees').textContent  = money(fees);
      $('#qTotal').textContent = money(total);

      quoteModal.dataset.payload = JSON.stringify({loc,date,time,hours,total});
      quoteModal.showModal();
    }

    async function handleConfirm(ev){
      ev.preventDefault();
      const payload = JSON.parse(quoteModal.dataset.payload||'{}');

      try{
        if (supabase){
          await supabase.from('booking_leads').insert({
            pickup_location: payload.loc,
            pickup_date: payload.date,
            pickup_time: payload.time,
            hours: payload.hours,
            quoted_total: payload.total,
            source: 'client-web'
          });
        }
      }catch(e){ if(debug) console.error(e); }

      quoteModal.close(); sheet.close();
      const t = $('#toast'); t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 2400);
    }

    // Silence console unless debug=1
    if(!debug){ console.log=console.warn=()=>{}; }
  </script>
</body>
</html>
